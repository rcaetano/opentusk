#cloud-config

package_update: true
package_upgrade: true

packages:
  - fail2ban
  - ufw
  - rsync
  - curl
  - git

users:
  - name: mustangclaw
    groups: docker
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_authorized_keys: []   # populated by DigitalOcean from your SSH key

runcmd:
  # ─── UFW Firewall ──────────────────────────────────────────────────────────
  - ufw default deny incoming
  - ufw default allow outgoing
  - ufw allow 22/tcp
  - ufw --force enable

  # ─── fail2ban ──────────────────────────────────────────────────────────────
  - systemctl enable fail2ban
  - systemctl start fail2ban

write_files:
  # ─── SSHD Hardening ───────────────────────────────────────────────────────
  - path: /etc/ssh/sshd_config.d/99-mustangclaw-hardening.conf
    permissions: "0644"
    content: |
      PasswordAuthentication no
      PermitRootLogin prohibit-password
      ChallengeResponseAuthentication no
